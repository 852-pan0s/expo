{"version":3,"file":"ProviderConfig.js","sourceRoot":"","sources":["../src/ProviderConfig.ts"],"names":[],"mappings":"AAAA,OAAO,SAAS,MAAM,WAAW,CAAC;AAElC,OAAO,EAAE,YAAY,EAAE,MAAM,SAAS,CAAC;AA4CvC;;;GAGG;AACH,MAAM,UAAU,sBAAsB,CAAC,MAAc;IACnD,OAAO,GAAG,MAAM,mCAAmC,CAAC;AACtD,CAAC;AAED,MAAM,CAAC,KAAK,UAAU,wBAAwB,CAAC,MAAc;IAC3D,MAAM,IAAI,GAAG,MAAM,YAAY,CAAoB,sBAAsB,CAAC,MAAM,CAAC,EAAE;QACjF,QAAQ,EAAE,MAAM;QAChB,MAAM,EAAE,KAAK;KACd,CAAC,CAAC;IAEH,OAAO;QACL,iBAAiB,EAAE,IAAI;QACvB,qBAAqB,EAAE,IAAI,CAAC,sBAAsB;QAClD,aAAa,EAAE,IAAI,CAAC,cAAc;QAClC,kBAAkB,EAAE,IAAI,CAAC,mBAAmB;QAC5C,gBAAgB,EAAE,IAAI,CAAC,iBAAiB;QACxC,kBAAkB,EAAE,IAAI,CAAC,oBAAoB;QAC7C,oBAAoB,EAAE,IAAI,CAAC,qBAAqB;KACjD,CAAC;AACJ,CAAC;AAED;;;;GAIG;AACH,MAAM,CAAC,KAAK,UAAU,0BAA0B,CAC9C,sBAA8C;IAE9C,SAAS,CACP,sBAAsB,IAAI,CAAC,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC,QAAQ,CAAC,OAAO,sBAAsB,CAAC,EACxF,uDAAuD,CACxD,CAAC;IACF,IAAI,OAAO,sBAAsB,KAAK,QAAQ,EAAE;QAC9C,OAAO,MAAM,wBAAwB,CAAC,sBAAsB,CAAC,CAAC;KAC/D;IACD,OAAO,sBAAsB,CAAC;AAChC,CAAC","sourcesContent":["import invariant from 'invariant';\n\nimport { requestAsync } from './Fetch';\n\nexport type DiscoveryDocument = Record<string, string | boolean | string[]> & {\n  authorization_endpoint: string;\n  token_endpoint: string;\n  revocation_endpoint?: string;\n  userinfo_endpoint?: string;\n  registration_endpoint?: string;\n  end_session_endpoint?: string;\n  claims_supported?: string[];\n  check_session_iframe?: string;\n  backchannel_logout_supported?: boolean;\n  backchannel_logout_session_supported?: boolean;\n  code_challenge_methods_supported?: string[];\n  device_authorization_endpoint?: string;\n  frontchannel_logout_session_supported?: boolean;\n  frontchannel_logout_supported?: boolean;\n  grant_types_supported?: string[];\n  id_token_signing_alg_values_supported?: string[];\n  introspection_endpoint?: string;\n  issuer?: string;\n  jwks_uri?: string;\n  request_parameter_supported?: boolean;\n  response_modes_supported?: string[];\n  scopes_supported?: string[];\n  subject_types_supported?: string[];\n  token_endpoint_auth_methods_supported?: string[];\n};\n\nexport interface ProviderConfig {\n  authorizationEndpoint: string;\n  tokenEndpoint: string;\n  // The spec requires a revocation endpoint but some providers (like Spotify) do not support one.\n  revocationEndpoint?: string;\n  userInfoEndpoint?: string;\n  endSessionEndpoint?: string;\n  // Dynamic client registration endpoint\n  registrationEndpoint?: string;\n\n  discoveryDocument: DiscoveryDocument;\n}\n\nexport type IssuerOrProviderConfig = string | ProviderConfig;\n\n/**\n * Append the well known resources path and OpenID connect discovery document path to a URL\n * https://tools.ietf.org/html/rfc5785\n */\nexport function issuerWithWellKnownUrl(issuer: string): string {\n  return `${issuer}/.well-known/openid-configuration`;\n}\n\nexport async function fetchProviderConfigAsync(issuer: string): Promise<ProviderConfig> {\n  const json = await requestAsync<DiscoveryDocument>(issuerWithWellKnownUrl(issuer), {\n    dataType: 'json',\n    method: 'GET',\n  });\n\n  return {\n    discoveryDocument: json,\n    authorizationEndpoint: json.authorization_endpoint,\n    tokenEndpoint: json.token_endpoint,\n    revocationEndpoint: json.revocation_endpoint,\n    userInfoEndpoint: json.userinfo_endpoint,\n    endSessionEndpoint: json.end_session_endpoint,\n    registrationEndpoint: json.registration_endpoint,\n  };\n}\n\n/**\n * Utility method for resolving the provider config from an issuer or object.\n *\n * @param issuerOrProviderConfig\n */\nexport async function resolveProviderConfigAsync(\n  issuerOrProviderConfig: IssuerOrProviderConfig\n): Promise<ProviderConfig> {\n  invariant(\n    issuerOrProviderConfig && !['number', 'boolean'].includes(typeof issuerOrProviderConfig),\n    'Expected a valid Provider configuration or issuer URL'\n  );\n  if (typeof issuerOrProviderConfig === 'string') {\n    return await fetchProviderConfigAsync(issuerOrProviderConfig);\n  }\n  return issuerOrProviderConfig;\n}\n"]}